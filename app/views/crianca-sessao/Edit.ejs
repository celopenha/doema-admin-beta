<!DOCTYPE html>
<html lang="pt-br">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="/img/sdc-color.svg" type="image/x-icon">
	<title><%- process.env.TITLE %></title>
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,700&subset=latin,cyrillic-ext" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" type="text/css">

	<!-- Bootstrap Core Css -->
	<link href="/js/plugins/bootstrap/css/bootstrap.css" rel="stylesheet">

	<!-- Waves Effect Css -->
	<link href="/js/plugins/node-waves/waves.css" rel="stylesheet" />

	<!-- Animation Css -->
	<link href="/js/plugins/animate-css/animate.css" rel="stylesheet" />

	<!-- Bootstrap Material Datetime Picker Css -->
	<link href="/js/plugins/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css" rel="stylesheet" />

	<!-- Bootstrap DatePicker Css -->
	<link href="/js/plugins/bootstrap-datepicker/css/bootstrap-datepicker.css" rel="stylesheet" />

	<!-- Bootstrap Select Css -->
	<link href="/js/plugins/bootstrap-select/css/bootstrap-select.css" rel="stylesheet" />

	<!-- Wait Me Css -->
	<link href="/js/plugins/waitme/waitMe.css" rel="stylesheet" />

	<!-- SweetAlert -->
	<link href="/js/plugins/sweetalert/sweetalert.css" rel="stylesheet" />

	<!-- Custom Css -->
	<link href="/css/css/style.css" rel="stylesheet">
	<link href="/css/css/themes/all-themes.css" rel="stylesheet" />

</head>

<body class="theme-teal">
	<%- include ../template/topo.ejs %>
	<%- include ../template/menu.ejs %>
	<!-- Page Wrapper -->
	<section class="content">
        <!-- início do preloader -->
        <div id="preloader">
            <div class="inner">
                <div class="front">
                    <img src="/img/sdc-color.svg" w/>
                    <!-- HTML DA ANIMAÇÃO MUITO LOUCA DO SEU PRELOADER! -->
                    <div class="bolas">
                       <div></div>
                       <div></div>
                       <div></div>                    
                    </div>
                </div> 
            </div>
        </div>
		<!-- fim do preloader --> 
		<div class="content-fluid">
			<%- messages() %>
			<div class="block-header">
				<h2>Cadastrar Sessão para Criança</h2>
			</div>
			<form class="user" id="edit-agendamento" method="POST" action="/app/<%= page %>/edit/submit" enctype="multipart/form-data">
				<div class="row clearfix">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="card">
							<div class="header">
								<h2>Informações Gerais do Agendamento</h2>
							</div>
							<div class="body">
								<div class="row clearfix">
									<div class="col-sm-4">
										<div class="input-group">
											<div class="form-line">
												Dia											
												<input type="datetime-local" class="form-control" id="dia" name="dia" value="<%= dia %>" disabled>
												<input type="hidden" id="dia" name="dia" value="<%= dia %>">
											</div>
										</div>
									</div>
									<div class="col-sm-3">
										<div class="input-group">
											<div class="form-line">
												Sessão:
												<input type="text" class="form-control" value="<%= sessao %>" disabled>
												<input type="hidden" class="form-control show-tick" name="sessao" id="sessao" value="<%= sessao %>">
												<input type="hidden" id="sessao_id" name="sessao_id" value="<%= sessao_id %>">
											</div>
										</div>
									</div>
									<div class="col-sm-3">
										<div class="input-group">
											<div class="form-line">
												Responsável:
												<input type="text" class="form-control" value="<%= nomeEscola %>" disabled>
												<input type="hidden" class="form-control show-tick" value="<%= nomeEscola %>">
											</div>
										</div>
									</div>
								</div>
								<% if (aniversario == false) { %>
									
								<div class="row clearfix">
									<div class="col-sm-12">
										<div class="input-group form-line">
											Crianças:
											<br><br>
											<div class="table-responsive">
												<table class="table table-bordered table-striped table-hover js-basic-example dataTable" id="dataTable" width="100%" cellspacing="0">
													<thead>
														<tr>
															<th>Nome</th>
															<th>Alergia</th>
															<th>Deficiência</th>
														</tr>
													</thead>
													<tfoot>
														<tr>
															<th>Nome</th>
															<th>Alergia</th>
															<th>Deficiência</th>
														</tr>
													</tfoot>
													<tbody>
														<% for (var i = 0; i < vagas.length; i++) { %>
														<tr>
															<td><%= vagas[i].nome %></td>
															<td><%= vagas[i].alergico == true ? vagas[i].tipoAlergia : 'A criança não possui alergia!'%></td>
															<td><%= vagas[i].tipoDeficiencia != 'FALSE' ? vagas[i].tipoDeficiencia : 'A criança não possui deficiência!'%></td>															
															<input type="hidden" id="crianca_id" name="crianca_id[<%=i%>]" value="<%= vagas[i].id %>">				
														</tr>
														<% } %>
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
								<% } %>
								<input type="hidden" name="aniversario" value="<%= aniversario %>">
								<div class="row clearfix">
									<% for(var i = 0; i < camposadicionais.length; i++) { %>
										<div class="col-sm-3">
											<div class="input-group">
												<div class="form-line">
													<%= camposadicionais[i].campoAdicional.nome %>
													<%= console.log(camposadicionais[i].campoAdicional.tipoArquivo) %>
													<% if (camposadicionais[i].campoAdicional.tipoArquivo == 'TEXTO') { %>
														<input type="text" class="form-control" value="<%= camposadicionais[i].valor %>" disabled>
													<% } else if (camposadicionais[i].campoAdicional.tipoArquivo == 'TEXTAREA') { %>
														<textarea rows="4" class="form-control no-resize" maxlength="145" disabled><%= camposadicionais[i].valor %></textarea>
													<% } else { %>
														<%= console.log("oi") %><br/>
														<a download="<%= camposadicionais[i].campoAdicional.nome %>" href="data:application/pdf;base64,<%= camposadicionais[i].valor %>" data-toggle="tooltip" data-placement="top"
															title="<%= camposadicionais[i].campoAdicional.nome %>" class="btn-sm"
															>
															<i class="material-icons" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">insert_drive_file</i>arquivo.pdf<br />
														</a>
													<% } %>
												</div>
											</div>
										</div>
									<% } %>
								</div>
								<div class="row clearfix">
									<div class="col-sm-3">
										<div class="input-group">
											<div class="form-line">
												Status do Agendamento:
												<select class="form-control" name="statusAgendamento" id="statusAgendamento" required>
													<option value="PRE_AGENDADO" disabled>Pré-Agendado</option>
													<option value="CONFIRMADO">Confirmado</option>
													<option value="INCOMUNICAVEL">Incomunicável</option>
													<option value="DESISTENCIA">Desistência</option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<input type="hidden" id="IdEscola" name="IdEscola" value="<%= IdEscola %>">
								<input type="hidden" name="statusPresenca" id="statusPresenca" value="<%= statusPresenca %>">
								<input type="hidden" id="id" name="id" value="<%= id %>">
							</div>
							<div class="footer-card">
								<input type="submit" id="edit" value="Salvar" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" />
								
								<% if (informacoes.controlRota === "listSessao"){ %>
								<a href="/app/crianca-sessao/list/<%= sessao_id %>/<%= sessao %>/" class="d-none d-sm-inline-block btn btn-sm btn-danger shadow-sm">Cancelar</a>
								<% } else { %>
									<a href="/app/crianca-sessao/list/responsavel/<%= IdEscola %>/<%= nomeEscola %>" class="d-none d-sm-inline-block btn btn-sm btn-danger shadow-sm">Cancelar</a>
								<% } %>
							</div>
						</div>
					</div>
				</div>
			</form>

		</div>
		<!-- End of Content Wrapper -->

	</section>
	<!-- End of Page Wrapper -->
	<!-- Logout Modal-->
	<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
				<div class="modal-footer">
					<button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
					<a class="btn btn-primary" href="login.html">Logout</a>
				</div>
			</div>
		</div>
	</div>


	<!-- Jquery Core Js -->
	<script src="/js/plugins/jquery/jquery.min.js"></script>	

	<!-- Bootstrap Core Js -->
	<script src="/js/plugins/bootstrap/js/bootstrap.js"></script>

	<!-- Select Plugin Js -->
	<script src="/js/plugins/bootstrap-select/js/bootstrap-select.js"></script>

	<!-- Slimscroll Plugin Js -->
	<script src="/js/plugins/jquery-slimscroll/jquery.slimscroll.js"></script>

	<!-- Waves Effect Plugin Js -->
	<script src="/js/plugins/node-waves/waves.js"></script>

	<!-- Autosize Plugin Js -->
	<script src="/js/plugins/autosize/autosize.js"></script>

	<!-- Moment Plugin Js -->
	<script src="/js/plugins/momentjs/moment.js"></script>

	<!-- Bootstrap Material Datetime Picker Plugin Js -->
	<script src="/js/plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>

	<!-- Bootstrap Datepicker Plugin Js -->
	<script src="/js/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>

	<!-- SweetAlert -->
	<script src="/js/plugins/sweetalert/sweetalert.min.js"></script>

	<!-- Custom Js -->
	<script src="/js/js/admin.js"></script>
	<script src="/js/js/pages/forms/basic-form-elements.js"></script>

	
	<script>
		$('#statusAgendamento option[value=<%= statusAgendamento %>]').attr('selected','selected');
		if('<%= statusAgendamento %>' === 'DESISTENCIA'){
			$('#statusAgendamento').attr('disabled','disabled');
		}


		$("#edit").on("click", function(event) {
			if ($("#statusAgendamento").val() == "DESISTENCIA") {
				event.preventDefault()
				swal({
					title: "Você tem certeza?",
					text: "Deseja salvar este agendamento como Desistência?",
					type: "warning",
					showCancelButton: true,
					confirmButtonClass: "btn-danger",
					confirmButtonText: "Sim, salvar alteração!",
					cancelButtonText: "Não, cancelar alteração!",
					closeOnConfirm: true,
					closeOnCancel: false
				},
				function(isConfirm) {
					if (isConfirm) {
						$("#edit-agendamento").submit();
					} else {
						swal("Cancelado", "As alterações não foram salvas. :)", "error");
					}
				});
				return false;
			}
			$("#edit-agendamento").submit();
		});

	</script>

</body>

</html>