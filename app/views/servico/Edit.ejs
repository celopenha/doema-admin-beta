<!DOCTYPE html>
<html lang="pt-br">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="/img/sdc-color.svg" type="image/x-icon">
	<title><%- process.env.TITLE %></title>
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,700&subset=latin,cyrillic-ext" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" type="text/css">

	<!-- Bootstrap Core Css -->
	<link href="/js/plugins/bootstrap/css/bootstrap.css" rel="stylesheet">

	<!-- Waves Effect Css -->
	<link href="/js/plugins/node-waves/waves.css" rel="stylesheet" />

	<!-- Animation Css -->
	<link href="/js/plugins/animate-css/animate.css" rel="stylesheet" />

	<!-- Dropzone Css -->
	<link href="/js/plugins/dropzone/dropzone.css" rel="stylesheet">

	<!-- Bootstrap Material Datetime Picker Css -->
	<link href="/js/plugins/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css"
		rel="stylesheet" />

	<!-- Bootstrap DatePicker Css -->
	<link href="/js/plugins/bootstrap-datepicker/css/bootstrap-datepicker.css" rel="stylesheet" />

	<!-- Wait Me Css -->
	<link href="/js/plugins/waitme/waitMe.css" rel="stylesheet" />

	<!-- Bootstrap Select Css -->
	<link href="/js/plugins/bootstrap-select/css/bootstrap-select.css" rel="stylesheet" />

	<!-- Custom Css -->
	<link href="/css/css/style.css" rel="stylesheet">
	<link href="/css/css/themes/all-themes.css" rel="stylesheet" />
</head>

<body class="theme-teal">
	<%- include ../template/topo.ejs %>
	<%- include ../template/menu.ejs %>

	<% if(informacoes.NivelUser == 'ADMIN'){%>
	<!-- Page Wrapper -->
	<section class="content">
        <!-- início do preloader -->
        <div id="preloader">
            <div class="inner">
                <div class="front">
                    <img src="/img/sdc-color.svg" w/>
                    <!-- HTML DA ANIMAÇÃO MUITO LOUCA DO SEU PRELOADER! -->
                    <div class="bolas">
                       <div></div>
                       <div></div>
                       <div></div>                    
                    </div>
                </div> 
            </div>
        </div>
		<!-- fim do preloader --> 
		<div class="content-fluid">
			<%- messages() %>
			<form class="user" id="frmFileUpload2" method="POST" action="/app/<%= page %>/edit/submit" enctype="multipart/form-data">
				<div class="row clearfix">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<div class="card">
							<div class="header">
								<h2>Editar Serviço</h2>
							</div>
							<div class="body">
								<div class="row clearfix">
									<div class="col-sm-12">
										<div class="input-group">
											<div class="form-line">
												Nome: *
												<input type="text" class="form-control show-tick" id="nome" name="nome" value="<%= nome %>" required>
											</div>
										</div>
									</div>
								</div>
								<div class="row clearfix">
									<div class="col-sm-12">
										<div class="input-group">
											<div class="form-line">
												Imagem: *
												<div class="dropzone" style="background-color: #eee !important; padding: 10px;">
													<div class="imageSelected" style="position: absolute; margin-top: 7px;">
														<div class="dz-preview dz-image-preview">
															<div class="dz-image" style="width: auto; max-width: 225px;">
																<img data-dz-thumbnail="" alt="IMG_6251.PNG" src="data:image/png;base64, <%= imagem %>"  style="height: 100%;">
															</div>
														</div>
													</div>
													<div class="dz-message">
														<div class="drag-icon-cph">
															<i class="material-icons">touch_app</i>
														</div>
														<h3>Solte a imagem aqui ou clique para fazer o upload.</h3>
													</div>
													<div class="fallback">
														<input type="file" id="photo" name="photo"/>
													</div>
													<div class="previewImage">
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="row clearfix">
									<div class="col-sm-12">
										<div class="input-group">
											<div class="form-line">
												Descrição:
												<textarea rows="4" class="form-control no-resize" maxlength="145" id="descricao" name="descricao" required><%= descricao %></textarea>
											</div>
										</div>
									</div>
								</div>
								<div class="row clearfix">
									<div class="col-sm-4">
										<div class="input-group">
											<div class="form-line">
												Status: *
												<select class="form-control show-tick" name="status"
													id="status" required>
													<option value="true" <%= status == true ? 'selected' : '' %>>Ativo</option>
													<option value="false" <%= status == false ? 'selected' : '' %>>Inativo</option>
												</select>
											</div>
										</div>
									</div>
									<div class="col-sm-4">
										<div class="input-group">
											<div class="form-line">
												Quantas pessoas podem se inscrever? *
												<select class="form-control show-tick" name="aniversario"
													id="status" required>
													<option value="true" <%= aniversario == true ? 'selected' : '' %>>Uma pessoa</option>
													<option value="false" <%= aniversario == false ? 'selected' : '' %>>Várias pessoas</option>
												</select>
											</div>
										</div>
									</div>
									<div class="col-sm-4">
										<div class="input-group">
											<div class="form-line">
												Deseja inserir campos adicionais? *
												<select class="form-control show-tick" name="camposadicionais"
													id="camposadicionais" onchange="insereCampos(this.value)" required>
													<option value="true" <%= camposAdicionais.length != 0 ? 'selected' : '' %>>Sim</option>
													<option value="false"  <%= camposAdicionais.length == 0 ? 'selected' : '' %>>Não</option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<div id="div_campos">
									<ul value="campos" class="list-unstyled" id="campos">
										<li id="campos">
											<% if (camposAdicionais.length != 0) { %>
												<% for (var i = 0; i < camposAdicionais.length; i++) { %>
													<div class="row input-group">
														<input type="hidden" name="campoid" id="campoid" value="<%= camposAdicionais[i].id %>">
														<div class="col-sm-4">
															<div class="form-line">
																Nome do Campo *
																<input class="form-control show-tick" type="text" name="camponome" id="camponome" value="<%= camposAdicionais[i].nome %>" required>
															</div>
														</div>
														<div class="col-sm-3">
															<div class="form-line">
																Tipo do Campo *
																<select class="form-control show-tick" name="campotipo" id="campotipo" required>
																	<option value="TEXTO" <%= camposAdicionais[i].tipoArquivo == 'TEXTO' ? 'selected' : '' %>>Texto Pequeno</option>
																	<option value="TEXTAREA" <%= camposAdicionais[i].tipoArquivo == 'TEXTAREA' ? 'selected' : '' %>>Texto Grande</option>
																	<option value="ARQUIVO" <%= camposAdicionais[i].tipoArquivo == 'ARQUIVO' ? 'selected' : '' %>>Arquivo</option>
																</select>
															</div>
														</div>
														<div class="col-sm-3">
															<div class="form-line">
																Campo obrigatório? *
																<select class="form-control show-tick" name="camposobrigatorio" id="camposobrigatorio" required>
																	<option value="true" <%= camposAdicionais[i].obrigatorio == true ? 'selected' : '' %>>Sim</option>
																	<option value="false" <%= camposAdicionais[i].obrigatorio == false ? 'selected' : '' %>>Não</option>
																</select>
															</div>
														</div>
													</div>
												<% } %>
											<% } %>
										</li>
									</ul>
								</div>
								<button id="btnAddCampo" type="button" class="btn btn-sm btn-success mb-2 mt-2">Adicionar Campo</button>
								<input type="hidden" id="id" name="id" value="<%= id %>">
							</div>
							<div class="footer-card">
								<input type="submit" value="Salvar" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" />
								<a href="/app/servico/list" class="d-none d-sm-inline-block btn btn-sm btn-danger shadow-sm">Cancelar</a>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
		<!-- End of Content Wrapper -->

	</section>
	<!-- End of Page Wrapper -->

	<!-- Logout Modal-->
	<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">Select "Logout" below if you are ready to end your current
					session.
				</div>
				<div class="modal-footer">
					<button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
					<a class="btn btn-primary" href="login.html">Logout</a>
				</div>
			</div>
		</div>
	</div>
	<% } %>

	<!-- Jquery Core Js -->
	<script src="/js/plugins/jquery/jquery.min.js"></script>

	<!-- Bootstrap Core Js -->
	<script src="/js/plugins/bootstrap/js/bootstrap.js"></script>

	<!-- Select Plugin Js -->
	<script src="/js/plugins/bootstrap-select/js/bootstrap-select.js"></script>

	<!-- Slimscroll Plugin Js -->
	<script src="/js/plugins/jquery-slimscroll/jquery.slimscroll.js"></script>

	<!-- Waves Effect Plugin Js -->
	<script src="/js/plugins/node-waves/waves.js"></script>

	<!-- Autosize Plugin Js -->
	<script src="/js/plugins/autosize/autosize.js"></script>

	<!-- Moment Plugin Js -->
	<script src="/js/plugins/momentjs/moment.js"></script>

	<!-- Dropzone Js -->
	<script src="/js/plugins/dropzone/dropzone.js"></script>

	<!-- Bootstrap Material Datetime Picker Plugin Js -->
	<script src="/js/plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>

	<!-- Bootstrap Datepicker Plugin Js -->
	<script src="/js/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>

	<!-- Custom Js -->
	<script src="/js/js/admin.js"></script>
	<script src="/js/js/pages/forms/basic-form-elements.js"></script>

	<script>
		window.onload = () => {
			var tamanho = '<%= camposAdicionais.length %>';
			if ( tamanho == 0) {
				document.getElementById('div_campos').classList.add('hidden');
				document.getElementById('btnAddCampo').classList.add('hidden');
			}
		}
		function insereCampos(valor) {
			if (valor == 'true') {
				document.getElementById('div_campos').classList.remove('hidden');
				document.getElementById('btnAddCampo').classList.remove('hidden');
				$('#camponome').attr('required', true);
				$('#campotipo').attr('required', true);
				$('#camposobrigatorio').attr('required', true);
			} else {
				document.getElementById('div_campos').classList.add('hidden');
				document.getElementById('btnAddCampo').classList.add('hidden');
				$('#camponome').attr('required', false);
				$('#campotipo').attr('required', false);
				$('#camposobrigatorio').attr('required', false);
			}
		}
		$(function () {
			var scntDiv = $('#div_campos');
			var i = $('#div_campos li').length + 1;

			$('#btnAddCampo').on('click', function () {
				$(
					'<div id="addCampo" class="row input-group">' +
					'<div class="col-sm-4">' +
					'<div class="form-line">' +
					'Nome do Campo *' +
					'	<input type="text" class="form-control" id="camponome' + i + '" name="camponome" required>' +
					'</div></div>' +
					'<div class="col-sm-3"><div class="form-line">'+
					'Tipo do campo *'+
					'<select class="form-control show-tick" name="campotipo" id="campotipo' + i + '" required>' +
					'<option value="TEXTO">Texto Pequeno</option>' +
					'<option value="TEXTAREA">Texto Grande</option>' +
					'<option value="ARQUIVO">Arquivo</option>' +
					'</select></div></div>' +
					'<div class="col-sm-3"><div class="form-line">'+
					'Campo obrigatório? *'+
					'<select class="form-control show-tick" name="camposobrigatorio" id="camposobrigatorio' + i + '" required>' +
					'<option value="true">Sim</option>' +
					'<option value="false">Não</option>' +
					'</select></div></div>' +
					'<div class="col-sm-1"><br/>' +
					'<button id="btnRemCampo" type="button" class="btn btn-sm btn-danger">' +
					'<i class="material-icons" style="color: white;">clear</i>' +
					'</button>'
					+ '</div>' +
					'</div>'
				).appendTo(scntDiv);
				i++;

				if (i == 11) {
					$('#btnAddCampo').attr('disabled', true);
				}

				return false;
			});
			$(document).on('click', '#btnRemCampo', function () {
				if (i > 2) {
					$('#addCampo').remove();
					i--;
				}
				if (i != 11) {
					$('#btnAddCampo').attr('disabled', false);
				}
				return false;
			}); 
		});
	</script>


	<script>
		Dropzone.autoDiscover = false;
		$("#frmFileUpload2").dropzone({ 
			url: '/app/<%= page %>/edit/submit',
			paramName: "photo",
			autoProcessQueue: false,
			uploadMultiple: false,
			maxFiles: "1",
			createImageThumbnails: true,
			addRemoveLinks: true,
			acceptedMimeTypes: "image/*",
			previewsContainer: ".previewImage",
      		dictCancelUpload: "Cancelar Upload",
			dictRemoveFile: "Remover Imagem",
			accept: function(file, done) {
				done(file.nome)
			},
			maxfilesexceeded: function(file) {
				this.removeAllFiles();
				this.addFile(file);
			},
			init: function() {
				controle = false; 
				this.on("addedfile", function (file) {
					$(".imageSelected").hide();
					$(".dz-message").hide();
					controle = true; 
				})

				this.on("removedfile", function (file) {
					$(".imageSelected").show();
					$(".dz-message").show();
					controle = false; 
				})
				var submitButton = $("#frmFileUpload2");
				var wrapperThis = this;

				submitButton.submit(function (e) {
					if (controle == true){
						e.preventDefault();
						e.stopPropagation();
						wrapperThis.processQueue();
					}
				});

				//send all the form data along with the files:
				this.on("sendingmultiple", function(data, xhr, formData) {
					formData.append("nome", $("#nome").val());
					formData.append("descricao", $("#descricao").val());
					formData.append("status", $("#status").val());
					formData.append("campoid", $("#campoid").val());
					formData.append("camponome", $("#camponome").val());
					formData.append("campotipo", $("#campotipo").val());
					formData.append("camposobrigatorio", $("#camposobrigatorio").val());

					for (var n = 0; n < i; n++) {
						formData.append("camponome" + i, $("#camponome" + i).val());
						formData.append("campotipo" + i, $("#campotipo" + i).val());
						formData.append("camposobrigatorio" + i, $("#camposobrigatorio" + i).val());
					}
				});
			},
			success: function(file, response) {
				window.location.replace('/app/<%= page %>/list');
			},
			error: function(file, response) {
				window.location.replace('/app/<%= page %>/list');
			}
		});
	</script>

</body>

</html>